
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{HierarchicalClusteringAlgorithm}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{Clustering Challenge: Partitioning Two-Thousand Stocks by their
return
series}\label{clustering-challenge-partitioning-two-thousand-stocks-by-their-return-series}

Attached .csv file contains return series of 2,000 stocks(columns) for
3,000 days(rows). Please make 10 partition groups of 2,000 stocks
satisfying following conditions.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Each partition group has 200 stocks.
\item
  Minimize inter-group return correlation and maximize intra-group
  return correlation. Objective function will be CARS/TICS.
\item
  Intra-group return correlation TICS is defined as below. For each
  partition group with label k, 200x200 correlation matrix IC(k) can be
  calculated. ICS(k) is a summation of all elements in IC(k). TICS =
  ICS(1) + ICS(2) + \ldots{} + ICS(10)
\item
  Inter-group return correlation CARS is defines as below. AR(k) is a
  return series obtained by averaging over 200 stocks' return series.
  Then AR(k) is a vector with 3,000 elements(3,000 days). CAR is 10x10
  correlation matrix of {[}AR(1), AR(2), \ldots{} AR(10){]} and CARS is
  a summation of all elements in CAR matrix.
\end{enumerate}

    \subsubsection{Intuition:}\label{intuition}

For normal Machine Learning clustering algorithms, such as K-Means
algorithm, the absolute co-ordinates of points are needed. The
correlation problem can be seen as a clustering problem in which only
relative distances of points are provided.Without absolute co-ordinates,
normal clustering algorithms are not applicable in solving this problem.
Also, directly importing existing Machine Learning Python packages is
not applicable, and we need to re-write a class based on our unique
requirements.

Hence, I re-wrote Hierarchical Clustering algorithm to solve the
problem.

    \section{Challenge 1: No requirement of same sizes of
clusters.}\label{challenge-1-no-requirement-of-same-sizes-of-clusters.}

\subsubsection{1.1.1 Description}\label{description}

You are required to use Python 2.7 or C++ as your programming language.
You mayor may not automate all the process which the question is asking
you to solve. If you think a certain part takes longer time foryou to
code, you may skipthat part and manually compete the task. Task is
mainly on data science problem.

Please download daily price data of about 500 stocks in S\&P 500 to
calculate daily return series of 500 stock in S\&P500. Now you can
calculate correlation between 500 stocksfrom return series. This will be
written as 500 x500 matrix with ones along the diagonal.

Let's define Corr(A,B) as the correlation coefficient between A and B
derived from their return series. Then, build clusters satisfying the
following conditions: Correlation between any pair of stock in the same
cluster must be higher than pair of stocks from different cluster. For
example, A and B are from one cluster and C are foranother cluster;
Corr(A,B) \textgreater{}= Corr(A,C) and Corr(A,B) \textgreater{}=
Corr(B,C)

Then, you are now supposed to find clusters defined above to optimize
the following objective functions.

    \subsubsection{1.1.2 Requirements:}\label{requirements}

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\item
  Summation over Correlations between stocks in the same cluster is
  maximized.This sum of correlation is sum of all the elements in
  correlation matrix.I.e.ifyou constructed aclusterwith100 stocks.You
  can calculate 100 x 100 correlation matrix and sum up all the elements
  to get "sum of correlation". In other word, stocksin the same cluster
  must be highly correlated.
\item
  The number of clusters is not restricted as long as you have more than
  four clusters. But standard deviation of the numbers of clusters is to
  be minimized. For example, clusters of 100 stocks, 100 stocks, 100
  stocks and 200 stocks are better than those of 300 stocks, 160 stocks,
  35 stocks and 5 stocks.
\item
  You can calculate the average of returns of stocks in the same
  cluster. If you have four clusters, you will have four average
  returns, from which 4x4 correlation matrix can be calculated.
  Summation over Correlation between average returns of clusters is
  minimized. In other word, clusters must not be correlated in termsof
  average return.
\end{enumerate}

    \subsubsection{1.2 Data, Code and Answer}\label{data-code-and-answer}

    503 stocksfrom S\&P 500 have available daily prices fromYahoo! Finance
and Quandl databases.

Intra-group return correlation TICS is defined as below. For each
partition group with label k, 200x200 correlation matrix IC(k) can be
calculated. ICS(k) is a summation of all elements in IC(k). TICS =
ICS(1) + ICS(2) + \ldots{} + ICS(10).

Inter-group return correlation CARS is defines as below. AR(k)is a
return series obtained by averaging over 200 stocks'return
series.ThenAR(k)is a vector with 3,000 elements(3,000 days). CAR is
10x10 correlation matrix of {[}AR(1),AR(2), \ldots{}AR(10){]} and CARS
is a summation of all elements in CAR matrix.

To find clusters with maximum TICS, maximum CARS and similar sizes, the
results are as below.

    \paragraph{1.2.1 Code for downloading stock returns from Yahoo! Finance,
Quandl and IEX
datasets.}\label{code-for-downloading-stock-returns-from-yahoo-finance-quandl-and-iex-datasets.}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{import} \PY{n+nn}{os}
        \PY{k+kn}{import} \PY{n+nn}{fix\PYZus{}yahoo\PYZus{}finance} \PY{k}{as} \PY{n+nn}{yf}
        \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
        \PY{k+kn}{import} \PY{n+nn}{pandas\PYZus{}datareader}\PY{n+nn}{.}\PY{n+nn}{data} \PY{k}{as} \PY{n+nn}{web}
        \PY{k+kn}{from} \PY{n+nn}{datetime} \PY{k}{import} \PY{n}{datetime}\PY{p}{,}\PY{n}{date}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{c+c1}{\PYZsh{}Download daily prices from Yahoo! Finance}
        \PY{k}{def} \PY{n+nf}{yahooFinanceDownload}\PY{p}{(}\PY{n}{ticker}\PY{p}{,}\PY{n}{filepath}\PY{p}{,}\PY{n}{start\PYZus{}date}\PY{p}{,}\PY{n}{end\PYZus{}date}\PY{p}{)}\PY{p}{:}
            \PY{n}{prices} \PY{o}{=} \PY{n}{yf}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{n}{ticker}\PY{p}{,} \PY{n}{start}\PY{o}{=}\PY{n}{start\PYZus{}date}\PY{p}{,} \PY{n}{end}\PY{o}{=}\PY{n}{end\PYZus{}date}\PY{p}{)} 
            \PY{k}{if} \PY{n+nb}{len}\PY{p}{(}\PY{n}{prices}\PY{p}{)}\PY{p}{:}
                \PY{n}{out\PYZus{}filename} \PY{o}{=} \PY{n}{filepath} \PY{o}{+} \PY{n}{ticker} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.csv}\PY{l+s+s1}{\PYZsq{}}
                \PY{n}{prices}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{n}{out\PYZus{}filename}\PY{p}{)}
        
        \PY{k}{def} \PY{n+nf}{quandlDownload}\PY{p}{(}\PY{n}{ticker}\PY{p}{,}\PY{n}{filepath}\PY{p}{)}\PY{p}{:}
            \PY{n}{start} \PY{o}{=} \PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2000}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{end} \PY{o}{=} \PY{n}{date}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)}
            \PY{k}{try}\PY{p}{:}
                \PY{n}{prices} \PY{o}{=} \PY{n}{web}\PY{o}{.}\PY{n}{DataReader}\PY{p}{(}\PY{n}{ticker}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{quandl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{start}\PY{p}{,} \PY{n}{end}\PY{p}{)}
            \PY{k}{except}\PY{p}{:}
                \PY{k}{pass}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{out\PYZus{}filename} \PY{o}{=} \PY{n}{filepath} \PY{o}{+} \PY{n}{ticker} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.csv}\PY{l+s+s1}{\PYZsq{}}
                \PY{n}{prices}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{n}{out\PYZus{}filename}\PY{p}{)}
            
        \PY{k}{def} \PY{n+nf}{collectStockName}\PY{p}{(}\PY{n}{filepath}\PY{p}{)}\PY{p}{:}
            \PY{n}{stock\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{root}\PY{p}{,} \PY{n}{dirs}\PY{p}{,} \PY{n}{files} \PY{o+ow}{in} \PY{n}{os}\PY{o}{.}\PY{n}{walk}\PY{p}{(}\PY{n}{filepath}\PY{p}{)}\PY{p}{:}
                \PY{k}{if} \PY{n}{files}\PY{p}{:}
                    \PY{k}{for} \PY{n}{f} \PY{o+ow}{in} \PY{n}{files}\PY{p}{:}
                        \PY{k}{if} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{csv}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{f}\PY{p}{:}
                            \PY{n}{stock\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{f}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
            \PY{k}{return} \PY{n}{stock\PYZus{}list}
        
        \PY{k}{def} \PY{n+nf}{getDownloadList}\PY{p}{(}\PY{n}{ticker\PYZus{}list}\PY{p}{,}\PY{n}{filepath}\PY{p}{)}\PY{p}{:}
            \PY{n}{download\PYZus{}list} \PY{o}{=} \PY{n}{collectStockName}\PY{p}{(}\PY{n}{filepath}\PY{p}{)}
            \PY{n}{unsuccess\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{ticker} \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{ticker\PYZus{}list} \PY{k}{if} \PY{n}{ticker} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{download\PYZus{}list}\PY{p}{]}
            \PY{k}{return} \PY{n}{download\PYZus{}list}\PY{p}{,} \PY{n}{unsuccess\PYZus{}list}
\end{Verbatim}


    \subsubsection{1.2.2 Algorithm}\label{algorithm}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k}{class} \PY{n+nc}{Node}\PY{p}{(}\PY{n+nb}{object}\PY{p}{)}\PY{p}{:}
            \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{index\PYZus{}list}\PY{p}{,}\PY{n}{position}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,}\PY{n}{count}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{count} \PY{o}{=} \PY{n}{count}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{index\PYZus{}list} \PY{o}{=} \PY{n}{index\PYZus{}list}  
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{position} \PY{o}{=} \PY{n}{position}
        
        \PY{k}{class} \PY{n+nc}{EqualSizedClustering}\PY{p}{(}\PY{n+nb}{object}\PY{p}{)}\PY{p}{:}
            \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{corr\PYZus{}matrix}\PY{p}{,}\PY{n}{k}\PY{p}{,}\PY{n}{node\PYZus{}size}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{k} \PY{o}{=} \PY{n}{k}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{corr\PYZus{}matrix} \PY{o}{=} \PY{n}{corr\PYZus{}matrix}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{\PYZus{}len} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{corr\PYZus{}matrix}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                \PY{k}{if} \PY{n}{node\PYZus{}size} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{\PYZus{}len}\PY{o}{/}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{k}\PY{p}{)}
                \PY{k}{else}\PY{p}{:}
                    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size} \PY{o}{=} \PY{n}{node\PYZus{}size}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{all\PYZus{}index} \PY{o}{=} \PY{p}{[}\PY{n}{i} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{\PYZus{}len}\PY{p}{)}\PY{p}{]}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df} \PY{o}{=} \PY{k+kc}{None}
        
            \PY{k}{def} \PY{n+nf}{initial\PYZus{}fit}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
                \PY{n}{nodes} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{all\PYZus{}index}\PY{p}{:}
                    \PY{n}{nodes}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{Node}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{position}\PY{o}{=}\PY{n}{i}\PY{p}{,}\PY{n}{count}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
                \PY{n}{position} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
                \PY{n}{distances} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
        
                \PY{n}{new\PYZus{}nodes} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        
                \PY{k}{while} \PY{k+kc}{True}\PY{p}{:}
                    \PY{n}{max\PYZus{}dist} \PY{o}{=} \PY{l+m+mi}{0}
                    \PY{n}{nodes\PYZus{}len} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{nodes}\PY{p}{)}
        
                    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{nodes\PYZus{}len}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                        \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{nodes\PYZus{}len}\PY{p}{)}\PY{p}{:}
                            \PY{n}{node\PYZus{}a}\PY{p}{,}\PY{n}{node\PYZus{}b} \PY{o}{=} \PY{n}{nodes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{nodes}\PY{p}{[}\PY{n}{j}\PY{p}{]}
                            \PY{n}{position\PYZus{}pair} \PY{o}{=} \PY{p}{(}\PY{n}{node\PYZus{}a}\PY{o}{.}\PY{n}{position}\PY{p}{,}\PY{n}{node\PYZus{}b}\PY{o}{.}\PY{n}{position}\PY{p}{)}
                            \PY{k}{if} \PY{n}{position\PYZus{}pair} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{distances}\PY{p}{:}
                                \PY{n}{distances}\PY{p}{[}\PY{n}{position\PYZus{}pair}\PY{p}{]} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}distance}\PY{p}{(}\PY{n}{node\PYZus{}a}\PY{p}{,}\PY{n}{node\PYZus{}b}\PY{p}{)}
                            \PY{n}{d} \PY{o}{=} \PY{n}{distances}\PY{p}{[}\PY{n}{position\PYZus{}pair}\PY{p}{]}
                            \PY{k}{if} \PY{n}{max\PYZus{}dist} \PY{o}{\PYZlt{}} \PY{n}{d}\PY{p}{:}
                                \PY{n}{max\PYZus{}dist} \PY{o}{=} \PY{n}{d}
                                \PY{n}{max\PYZus{}i} \PY{o}{=} \PY{n}{i}
                                \PY{n}{max\PYZus{}j} \PY{o}{=} \PY{n}{j}
                                \PY{n}{max\PYZus{}node\PYZus{}a} \PY{o}{=} \PY{n}{node\PYZus{}a}
                                \PY{n}{max\PYZus{}node\PYZus{}b} \PY{o}{=} \PY{n}{node\PYZus{}b}
                                
                    \PY{n}{node\PYZus{}a} \PY{o}{=} \PY{n}{max\PYZus{}node\PYZus{}a}
                    \PY{n}{node\PYZus{}b} \PY{o}{=} \PY{n}{max\PYZus{}node\PYZus{}b}
        
                    \PY{n}{new\PYZus{}index\PYZus{}list} \PY{o}{=} \PY{n}{node\PYZus{}a}\PY{o}{.}\PY{n}{index\PYZus{}list} \PY{o}{+} \PY{n}{node\PYZus{}b}\PY{o}{.}\PY{n}{index\PYZus{}list}
                    \PY{n}{new\PYZus{}count} \PY{o}{=} \PY{n}{node\PYZus{}a}\PY{o}{.}\PY{n}{count} \PY{o}{+} \PY{n}{node\PYZus{}b}\PY{o}{.}\PY{n}{count}
                    \PY{n}{new\PYZus{}node} \PY{o}{=} \PY{n}{Node}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{o}{=}\PY{n}{new\PYZus{}index\PYZus{}list}\PY{p}{,}\PY{n}{count}\PY{o}{=}\PY{n}{new\PYZus{}count}\PY{p}{,}\PY{n}{position}\PY{o}{=}\PY{n}{position}\PY{p}{)} 
                    \PY{k}{if} \PY{n+nb}{len}\PY{p}{(}\PY{n}{nodes}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{l+m+mi}{2}\PY{p}{:}
                        \PY{n}{nodes}\PY{o}{.}\PY{n}{pop}\PY{p}{(}\PY{n}{max\PYZus{}j}\PY{p}{)}
                        \PY{n}{nodes}\PY{o}{.}\PY{n}{pop}\PY{p}{(}\PY{n}{max\PYZus{}i}\PY{p}{)}
                    \PY{k}{else}\PY{p}{:}
                        \PY{n}{node\PYZus{}a} \PY{o}{=} \PY{n}{nodes}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                        \PY{n}{node\PYZus{}b} \PY{o}{=} \PY{n}{nodes}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
                        \PY{n}{new\PYZus{}index\PYZus{}list} \PY{o}{=} \PY{n}{node\PYZus{}a}\PY{o}{.}\PY{n}{index\PYZus{}list} \PY{o}{+} \PY{n}{node\PYZus{}b}\PY{o}{.}\PY{n}{index\PYZus{}list}
                        \PY{n}{new\PYZus{}count} \PY{o}{=} \PY{n}{node\PYZus{}a}\PY{o}{.}\PY{n}{count} \PY{o}{+} \PY{n}{node\PYZus{}b}\PY{o}{.}\PY{n}{count}
                        \PY{n}{new\PYZus{}node} \PY{o}{=} \PY{n}{Node}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{o}{=}\PY{n}{new\PYZus{}index\PYZus{}list}\PY{p}{,}\PY{n}{count}\PY{o}{=}\PY{n}{new\PYZus{}count}\PY{p}{,}\PY{n}{position}\PY{o}{=}\PY{n}{position}\PY{p}{)} 
                        \PY{n}{new\PYZus{}nodes}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{new\PYZus{}node}\PY{p}{)}
                        \PY{k}{break}
                    
                    \PY{k}{if} \PY{n}{new\PYZus{}node}\PY{o}{.}\PY{n}{count} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size}\PY{p}{:}
                        \PY{n}{new\PYZus{}nodes}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{new\PYZus{}node}\PY{p}{)}
                    \PY{k}{else}\PY{p}{:}             
                        \PY{n}{nodes}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{new\PYZus{}node}\PY{p}{)}
                    \PY{n}{position} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{l+m+mi}{1}
        
                    \PY{k}{if} \PY{n+nb}{len}\PY{p}{(}\PY{n}{nodes}\PY{p}{)}\PY{o}{+}\PY{n+nb}{len}\PY{p}{(}\PY{n}{new\PYZus{}nodes}\PY{p}{)} \PY{o}{==} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{k} \PY{p}{:}
                        \PY{k}{if} \PY{n+nb}{len}\PY{p}{(}\PY{n}{nodes}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
                            \PY{n}{new\PYZus{}nodes}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{n}{nodes}\PY{p}{)}
                        \PY{k}{break}
        
                    
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes} \PY{o}{=} \PY{n}{new\PYZus{}nodes}
        
            \PY{k}{def} \PY{n+nf}{adjust\PYZus{}size}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
                \PY{n}{exact\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{n}{node} \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes} \PY{k}{if} \PY{n}{node}\PY{o}{.}\PY{n}{count} \PY{o}{==} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size}\PY{p}{]}
                \PY{n}{large\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{n}{node} \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes} \PY{k}{if} \PY{n}{node}\PY{o}{.}\PY{n}{count} \PY{o}{\PYZgt{}} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size}\PY{p}{]}
                \PY{n}{small\PYZus{}size} \PY{o}{=} \PY{p}{[}\PY{n}{node} \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes} \PY{k}{if} \PY{n}{node}\PY{o}{.}\PY{n}{count} \PY{o}{\PYZlt{}} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size}\PY{p}{]}
                \PY{n}{from\PYZus{}large\PYZus{}to\PYZus{}small} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                \PY{k}{if} \PY{n}{large\PYZus{}size} \PY{o}{!=} \PY{p}{[}\PY{p}{]}\PY{p}{:}
                    \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n}{large\PYZus{}size}\PY{p}{:}
                        \PY{n}{n} \PY{o}{=} \PY{n}{node}\PY{o}{.}\PY{n}{count} \PY{o}{\PYZhy{}} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size}
                        \PY{n}{remove\PYZus{}index} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{remove\PYZus{}smallest\PYZus{}index}\PY{p}{(}\PY{n}{node}\PY{p}{,}\PY{n}{n}\PY{p}{,}
                                                                  \PY{n}{distance}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{all\PYZus{}index}\PY{p}{)}
                        \PY{c+c1}{\PYZsh{}remove\PYZus{}index = self.remove\PYZus{}smallest\PYZus{}index(node,n)}
                        \PY{n}{from\PYZus{}large\PYZus{}to\PYZus{}small}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{n}{remove\PYZus{}index}\PY{p}{)}
                        \PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n}{remove\PYZus{}index}\PY{p}{:}
                            \PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{n}{index}\PY{p}{)}
                        \PY{n}{exact\PYZus{}size}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{node}\PY{p}{)}             
                    \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n}{small\PYZus{}size}\PY{p}{:}
                        \PY{n}{n} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}size} \PY{o}{\PYZhy{}} \PY{n}{node}\PY{o}{.}\PY{n}{count}
                        \PY{n}{temp\PYZus{}all\PYZus{}index} \PY{o}{=} \PY{p}{[}\PY{n}{index} \PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{all\PYZus{}index} \PY{k}{if} \PY{n}{index} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{from\PYZus{}large\PYZus{}to\PYZus{}small}\PY{p}{]}
                        \PY{n}{add\PYZus{}index} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{add\PYZus{}largest\PYZus{}index}\PY{p}{(}\PY{n}{node}\PY{p}{,}\PY{n}{from\PYZus{}large\PYZus{}to\PYZus{}small}\PY{p}{,}\PY{n}{n}\PY{p}{,}\PY{n}{distance}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{o}{=}\PY{n}{temp\PYZus{}all\PYZus{}index}\PY{p}{)}
                        
                        \PY{c+c1}{\PYZsh{}add\PYZus{}index = self.add\PYZus{}largest\PYZus{}index(node,from\PYZus{}large\PYZus{}to\PYZus{}small,n)}
                        \PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{n}{add\PYZus{}index}\PY{p}{)}
                        \PY{n}{exact\PYZus{}size}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{node}\PY{p}{)}
                        \PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n}{add\PYZus{}index}\PY{p}{:}
                            \PY{n}{from\PYZus{}large\PYZus{}to\PYZus{}small}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{n}{index}\PY{p}{)}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes} \PY{o}{=} \PY{n}{exact\PYZus{}size}
        
                
            \PY{k}{def} \PY{n+nf}{setDataDf}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{df}\PY{p}{)}\PY{p}{:}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df} \PY{o}{=} \PY{n}{df}   
                
            \PY{k}{def} \PY{n+nf}{ICS}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{node}\PY{p}{)}\PY{p}{:}
                \PY{n}{node\PYZus{}corr\PYZus{}matrix} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{corr\PYZus{}matrix}\PY{p}{[}\PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{]}
                \PY{k}{return} \PY{n}{node\PYZus{}corr\PYZus{}matrix}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
        
            \PY{k}{def} \PY{n+nf}{TICS}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
                \PY{n}{TICS} \PY{o}{=} \PY{l+m+mi}{0}
                \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes}\PY{p}{:}
                    \PY{n}{TICS} \PY{o}{+}\PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{ICS}\PY{p}{(}\PY{n}{node}\PY{p}{)}
                \PY{k}{return} \PY{n}{TICS}
        
            \PY{k}{def} \PY{n+nf}{AR}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{node}\PY{p}{)}\PY{p}{:}
                \PY{n}{temp} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{]}
                \PY{k}{return} \PY{n}{temp}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            
            \PY{k}{def} \PY{n+nf}{CARS}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
                \PY{n}{output} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{index}\PY{p}{)}
                \PY{n+nb}{id} \PY{o}{=} \PY{l+m+mi}{0}
                \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes}\PY{p}{:}
                    \PY{n+nb}{id} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                    \PY{n}{output}\PY{p}{[}\PY{n+nb}{id}\PY{p}{]} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{AR}\PY{p}{(}\PY{n}{node}\PY{p}{)}
                \PY{n}{temp} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{output}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                \PY{n}{cars} \PY{o}{=} \PY{n}{temp}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
                \PY{k}{return} \PY{n}{cars}
                
            \PY{k}{def} \PY{n+nf}{node\PYZus{}distance}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{node\PYZus{}a}\PY{p}{,}\PY{n}{node\PYZus{}b}\PY{p}{)}\PY{p}{:}
                \PY{n}{temp} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{corr\PYZus{}matrix}\PY{p}{[}\PY{n}{node\PYZus{}b}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{node\PYZus{}a}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{]}        
                \PY{k}{return} \PY{n}{temp}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
        
        
            \PY{k}{def} \PY{n+nf}{output\PYZus{}results}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{output\PYZus{}filename}\PY{p}{)}\PY{p}{:}
                \PY{n}{label} \PY{o}{=} \PY{l+m+mi}{0}
                \PY{n}{index\PYZus{}list}\PY{p}{,}\PY{n}{label\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}\PY{p}{,}\PY{p}{[}\PY{p}{]}
                \PY{k}{for} \PY{n}{node} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{nodes}\PY{p}{:}
                    \PY{n}{label} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                    \PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{:}
                        \PY{n}{index\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{index}\PY{p}{)}
                        \PY{n}{label\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{label}\PY{p}{)}
                \PY{n}{output} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stock}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{label\PYZus{}list}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{)}
                \PY{n}{output}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{n}{output\PYZus{}filename}\PY{p}{)}
                
            \PY{k}{def} \PY{n+nf}{current\PYZus{}target\PYZus{}value}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
                \PY{n}{cars} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{CARS}\PY{p}{(}\PY{p}{)}
                \PY{n}{tics} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{TICS}\PY{p}{(}\PY{p}{)}
                \PY{n}{value} \PY{o}{=} \PY{n}{cars}\PY{o}{/}\PY{n}{tics}
                \PY{k}{return} \PY{n}{cars}\PY{p}{,}\PY{n}{tics}\PY{p}{,}\PY{n}{value}
            
            \PY{k}{def} \PY{n+nf}{remove\PYZus{}smallest\PYZus{}index}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{node}\PY{p}{,}\PY{n}{remove\PYZus{}num}\PY{p}{,}\PY{n}{distance}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{n}{index\PYZus{}list} \PY{o}{=} \PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}
                \PY{n}{remove\PYZus{}index} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                \PY{n}{contributions} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{p}{)}\PY{p}{)}
                \PY{k}{for} \PY{n}{pos} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                    \PY{n}{index} \PY{o}{=} \PY{n}{index\PYZus{}list}\PY{p}{[}\PY{n}{pos}\PY{p}{]}
                    \PY{n}{temp\PYZus{}node} \PY{o}{=} \PY{n}{Node}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{)}
                    \PY{k}{if} \PY{n}{distance}\PY{p}{:}
                        \PY{n}{contributions}\PY{p}{[}\PY{n}{pos}\PY{p}{]}\PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}distance}\PY{p}{(}\PY{n}{node}\PY{p}{,}\PY{n}{temp\PYZus{}node}\PY{p}{)}
                    \PY{k}{else}\PY{p}{:}
                        \PY{n}{contributions}\PY{p}{[}\PY{n}{pos}\PY{p}{]} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{relative\PYZus{}contributions}\PY{p}{(}\PY{n}{node}\PY{p}{,}\PY{n}{index}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{p}{)}
                \PY{k}{for} \PY{n}{select\PYZus{}time} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{remove\PYZus{}num}\PY{p}{)}\PY{p}{:}
                    \PY{n}{pos} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{contributions}\PY{o}{==}\PY{n}{contributions}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                    \PY{n}{remove\PYZus{}index}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{p}{[}\PY{n}{pos}\PY{p}{]}\PY{p}{)}
                    \PY{n}{contributions}\PY{p}{[}\PY{n}{pos}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1000}
                \PY{k}{return} \PY{n}{remove\PYZus{}index}
            
            \PY{k}{def} \PY{n+nf}{deleteIndex}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{del\PYZus{}index}\PY{p}{,}\PY{n}{index\PYZus{}list}\PY{p}{)}\PY{p}{:}
                \PY{n}{new\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        
                \PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n}{index\PYZus{}list}\PY{p}{:}
                    \PY{k}{if} \PY{n}{index} \PY{o}{!=} \PY{n}{del\PYZus{}index}\PY{p}{:}
                        \PY{n}{new\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{index}\PY{p}{)}
                \PY{k}{return} \PY{n}{new\PYZus{}list}
            
            \PY{k}{def} \PY{n+nf}{relative\PYZus{}contributions}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{node}\PY{p}{,}\PY{n}{index}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{p}{)}\PY{p}{:}
                \PY{n}{index\PYZus{}list} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{deleteIndex}\PY{p}{(}\PY{n}{index}\PY{p}{,}\PY{n}{node}\PY{o}{.}\PY{n}{index\PYZus{}list}\PY{p}{)}
                \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{corr\PYZus{}matrix}\PY{p}{[}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{index\PYZus{}list}\PY{p}{]}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{o}{/}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{corr\PYZus{}matrix}\PY{p}{[}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{p}{]}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
                
            \PY{k}{def} \PY{n+nf}{add\PYZus{}largest\PYZus{}index}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{node}\PY{p}{,}\PY{n}{add\PYZus{}index\PYZus{}candidate}\PY{p}{,}\PY{n}{add\PYZus{}num}\PY{p}{,}\PY{n}{distance}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{n}{add\PYZus{}index} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                \PY{n}{contributions} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{add\PYZus{}index\PYZus{}candidate}\PY{p}{)}\PY{p}{)} 
                \PY{k}{for} \PY{n}{pos} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{add\PYZus{}index\PYZus{}candidate}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                    \PY{n}{index} \PY{o}{=} \PY{n}{add\PYZus{}index\PYZus{}candidate}\PY{p}{[}\PY{n}{pos}\PY{p}{]}
                    \PY{n}{temp\PYZus{}node} \PY{o}{=} \PY{n}{Node}\PY{p}{(}\PY{n}{index\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{)}
                    \PY{k}{if} \PY{n}{distance}\PY{p}{:}
                        \PY{n}{contributions}\PY{p}{[}\PY{n}{pos}\PY{p}{]}\PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{node\PYZus{}distance}\PY{p}{(}\PY{n}{node}\PY{p}{,}\PY{n}{temp\PYZus{}node}\PY{p}{)}
                    \PY{k}{else}\PY{p}{:}
                        \PY{n}{contributions}\PY{p}{[}\PY{n}{pos}\PY{p}{]} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{relative\PYZus{}contributions}\PY{p}{(}\PY{n}{node}\PY{p}{,}\PY{n}{index}\PY{p}{,}\PY{n}{all\PYZus{}index}\PY{p}{)}
                \PY{k}{for} \PY{n}{select\PYZus{}time} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{add\PYZus{}num}\PY{p}{)}\PY{p}{:}
                    \PY{n}{pos} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{contributions}\PY{o}{==}\PY{n}{contributions}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                    \PY{n}{add\PYZus{}index}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{add\PYZus{}index\PYZus{}candidate}\PY{p}{[}\PY{n}{pos}\PY{p}{]}\PY{p}{)}
                    \PY{n}{contributions}\PY{p}{[}\PY{n}{pos}\PY{p}{]} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1000}
                \PY{k}{return} \PY{n}{add\PYZus{}index}
            
\end{Verbatim}


    \subsubsection{1.2.3 Answers}\label{answers}

    \paragraph{To find clusters with maximum TICS, maximum CARS and similar
sizes, the results are as
below.}\label{to-find-clusters-with-maximum-tics-maximum-cars-and-similar-sizes-the-results-are-as-below.}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}c201}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n}{corr} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{D:/c102/c102\PYZus{}corr.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{corr\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
             \PY{n}{eqc} \PY{o}{=} \PY{n}{EqualSizedClustering}\PY{p}{(}\PY{n}{corr\PYZus{}matrix}\PY{o}{=}\PY{n}{corr\PYZus{}matrix}\PY{p}{,}\PY{n}{k}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,}\PY{n}{node\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{125}\PY{p}{)}
             \PY{n}{eqc}\PY{o}{.}\PY{n}{initial\PYZus{}fit}\PY{p}{(}\PY{p}{)}
             
             \PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{D:/c102/c102\PYZus{}data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{df} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{n}{i} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{503}\PY{p}{)}\PY{p}{]}
             
             \PY{n}{eqc}\PY{o}{.}\PY{n}{setDataDf}\PY{p}{(}\PY{n}{df}\PY{p}{)}
             \PY{n}{current\PYZus{}value} \PY{o}{=} \PY{n}{eqc}\PY{o}{.}\PY{n}{current\PYZus{}target\PYZus{}value}\PY{p}{(}\PY{p}{)}
             \PY{n}{output} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Result}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CARS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Result}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TICS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Result}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Target Value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{output}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}}\PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
             \PY{n}{test\PYZus{}c201}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
             CARS          TICS  Target Value
Result  14.455305  32423.822044      0.000446

    \end{Verbatim}

    \section{Challenge 2: Clusters must be with equal
sizes}\label{challenge-2-clusters-must-be-with-equal-sizes}

    Attached .csv file contains return series of 2,000 stocks(columns) for
3,000 days(rows). Please make 10 partition groups of 2,000 stocks
satisfying following conditions. 1. Each partition group has 200 stocks.
2. Minimize inter-group return correlation and maximize intra-group
return correlation. Objective function will be CARS/TICS. 3. Intra-group
return correlation TICS is defined as below. For each partition group
with label k, 200x200 correlation matrix IC(k) can be calculated. ICS(k)
is a summation of all elements in IC(k). TICS = ICS(1) + ICS(2) +
\ldots{} + ICS(10) 4. Inter-group return correlation CARS is defines as
below. AR(k) is a return series obtained by averaging over 200 stocks'
return series. Then AR(k) is a vector with 3,000 elements(3,000 days).
CAR is 10x10 correlation matrix of {[}AR(1), AR(2), \ldots{} AR(10){]}
and CARS is a summation of all elements in CAR matrix.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}HFC}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{D:/54\PYZus{}hfc\PYZus{}20170614\PYZus{}comp.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{df}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{n}{i} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2000}\PY{p}{)}\PY{p}{]}
             \PY{n}{corr} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}
             \PY{n}{corr\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
             \PY{n}{eqc} \PY{o}{=} \PY{n}{EqualSizedClustering}\PY{p}{(}\PY{n}{corr\PYZus{}matrix}\PY{o}{=}\PY{n}{corr\PYZus{}matrix}\PY{p}{,}\PY{n}{k}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}
             \PY{n}{eqc}\PY{o}{.}\PY{n}{initial\PYZus{}fit}\PY{p}{(}\PY{p}{)}   
             \PY{n}{eqc}\PY{o}{.}\PY{n}{setDataDf}\PY{p}{(}\PY{n}{df}\PY{p}{)}
             \PY{n}{current\PYZus{}value} \PY{o}{=} \PY{n}{eqc}\PY{o}{.}\PY{n}{current\PYZus{}target\PYZus{}value}\PY{p}{(}\PY{p}{)}
             \PY{n}{output} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Not Equal Sized Clusters}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CARS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Not Equal Sized Clusters}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TICS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Not Equal Sized Clusters}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Target Value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}
             \PY{n}{eqc}\PY{o}{.}\PY{n}{adjust\PYZus{}size}\PY{p}{(}\PY{p}{)}
             \PY{n}{value} \PY{o}{=} \PY{n}{eqc}\PY{o}{.}\PY{n}{current\PYZus{}target\PYZus{}value}\PY{p}{(}\PY{p}{)}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Equal Sized Clusters}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CARS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{n}{value}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Equal Sized Clusters}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TICS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{n}{value}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{output}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Equal Sized Clusters}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Target Value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{value}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{output}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}}\PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} This takes arount 40 minutes to get the results. Please be patient.\PYZbs{} }
             \PY{n}{test\PYZus{}HFC}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
                               CARS           TICS  Target Value
Not Equal Sized Clusters  67.048950  151963.456286      0.000441
Equal Sized Clusters      80.936464  135266.081639      0.000598

    \end{Verbatim}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
